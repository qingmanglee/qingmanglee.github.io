<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title><![CDATA[yii2 php多进程 出现 MySQL server has gone away]]></title>
    <url>%2F2017%2F08%2F09%2Fyii2-php%E5%A4%9A%E8%BF%9B%E7%A8%8B-%E5%87%BA%E7%8E%B0-MySQL-server-has-gone-away%2F</url>
    <content type="text"><![CDATA[问题&amp;场景在yii2的command，利用多进程消费数据库中的数据时，总是出现gone away。 分析在mysql的官方文档中其实有专门的章节说明这个问题，原因也是各种各样，详见；其中有一条刚好符合我的场景，大意就是，当fork的子进程都共用相同的mysql连接的时候，会出现该错误，每个子进程单独一个mysql连接即可解决。 You can also encounter this error with applications that fork child processes, all of which try to use the same connection to the MySQL server. This can be avoided by using a separate connection for each child process. 解决在子进程执行之前，先把mysql的连接close即可。 代码123456789101112131415for ($i = 0; $i &lt; $processNum; $i++) &#123; $pid = pcntl_fork(); if(!$pid)&#123; // 子进程处理 Yii::$app-&gt;db-&gt;close();// solve 子进程 MySQL server has gone away $this-&gt;_work($tasks[$i]); exit(0); &#125;&#125;Yii::$app-&gt;db-&gt;close();// solve 主进程 MySQL server has gone away$status = null;while(pcntl_waitpid(0, $status, WUNTRACED) != -1)&#123; pcntl_wexitstatus($status); CommonLog::saveLog(&apos;子进程结束&apos;.&quot;\n&quot;);&#125;]]></content>
      <categories>
        <category>php</category>
      </categories>
      <tags>
        <tag>php</tag>
        <tag>yii2</tag>
        <tag>多进程</tag>
        <tag>mysql</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[关于我]]></title>
    <url>%2Fabout%2Findex.html</url>
    <content type="text"><![CDATA[大学&emsp;&emsp;2016年本科毕业，大学期间浑浑噩噩的上课，但认认真真的学编程，挂过科，不过最后还是幸运的拿到了毕业证和学位证。期间主要在学习lnmp相关技术，开发过几个网站，拿过几个证书。这基本上就是我大学的全部了。 技能&emsp;&emsp;对各种编程语言、各种系统都有兴趣，玩过PHP、golang、js等等 工作&emsp;&emsp;2016/06 – 2017/02 就职于小米网&emsp;&emsp;2017/02 – 至今 就职于高德地图，打杂。。]]></content>
  </entry>
  <entry>
    <title><![CDATA[分类]]></title>
    <url>%2Fcategories%2Findex.html</url>
    <content type="text"></content>
  </entry>
  <entry>
    <title><![CDATA[标签]]></title>
    <url>%2Ftags%2Findex.html</url>
    <content type="text"></content>
  </entry>
</search>
